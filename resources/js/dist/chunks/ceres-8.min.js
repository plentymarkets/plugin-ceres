(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{320:function(t,e,i){var n=i(5),r=i(321).values;n({target:"Object",stat:!0},{values:function(t){return r(t)}})},321:function(t,e,i){var n=i(23),r=i(92),a=i(34),s=i(115).f,l=function(t){return function(e){for(var i,l=a(e),o=r(l),u=o.length,c=0,d=[];u>c;)i=o[c++],n&&!s.call(l,i)||d.push(t?[i,l[i]]:l[i]);return d}};t.exports={entries:l(!0),values:l(!1)}},394:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.attributes.length||Object.keys(t.possibleUnits).length>1&&t.isContentVisible?i("div",{staticClass:"row"},[t._l(t.attributes,(function(e){return i("div",{staticClass:"col-12 variation-select"},["dropdown"===e.type?i("div",{ref:"attributesContaner",refInFor:!0,staticClass:"input-unit"},[i("select",{staticClass:"custom-select",on:{change:function(i){return t.selectAttribute(e.attributeId,i.target.value)}}},[t.addPleaseSelectOption||!t.hasSelection?i("option",{domProps:{value:-1}},[t._v(t._s(t.$translate("Ceres::Template.singleItemPleaseSelect")))]):t._e(),t._v(" "),t.hasEmptyOption||null===t.selectedAttributes[e.attributeId]?i("option",{domProps:{value:null,selected:null===t.selectedAttributes[e.attributeId]}},[t._v(t._s(t.$translate("Ceres::Template.singleItemNoSelection")))]):t._e(),t._v(" "),t._l(e.values,(function(n){return i("option",{domProps:{value:n.attributeValueId,selected:n.attributeValueId===t.selectedAttributes[e.attributeId]}},[t.isAttributeSelectionValid(e.attributeId,n.attributeValueId)?[t._v("\n                            "+t._s(n.name)+"\n                        ")]:[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemInvalidAttribute",{name:n.name}))+"\n                        ")]],2)}))],2),t._v(" "),i("label",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.isTextCut(e.name),expression:"isTextCut(attribute.name)"}],attrs:{"data-toggle":"tooltip","data-placement":"top",title:e.name}},[t._v(t._s(e.name))])]):"box"===e.type||"image"===e.type?i("div",[i("span",{staticClass:"text-muted"},[t._v(t._s(e.name)+":")]),t._v(" "),i("b",[t._v(t._s(t.getSelectedAttributeValueName(e)))]),t._v(" "),i("div",{staticClass:"v-s-boxes py-3",class:{images:"image"===e.type}},[t.addPleaseSelectOption?i("div",{staticClass:"v-s-box bg-white empty-option",class:{active:-1===t.selectedAttributes[e.attributeId],invalid:!t.isAttributeSelectionValid(e.attributeId,-1)},on:{click:function(i){return t.selectAttribute(e.attributeId,-1)}}},[i("span",{staticClass:"mx-3"},[t._v(t._s(t.$translate("Ceres::Template.singleItemPleaseSelect")))])]):t._e(),t._v(" "),t.hasEmptyOption?i("div",{staticClass:"v-s-box bg-white empty-option",class:{active:null===t.selectedAttributes[e.attributeId],invalid:!t.isAttributeSelectionValid(e.attributeId,null)},on:{click:function(i){return t.selectAttribute(e.attributeId,null)}}},[i("span",{staticClass:"mx-3"},[t._v(t._s(t.$translate("Ceres::Template.singleItemNoSelection")))])]):t._e(),t._v(" "),t._l(e.values,(function(n){return i("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:!t.isAttributeSelectionValid(e.attributeId,n.attributeValueId),expression:"!isAttributeSelectionValid(attribute.attributeId, value.attributeValueId)"}],staticClass:"v-s-box bg-white",class:{active:n.attributeValueId===t.selectedAttributes[e.attributeId],invalid:!t.isAttributeSelectionValid(e.attributeId,n.attributeValueId)},attrs:{"data-html":"true","data-toggle":"tooltip","data-placement":"top","data-original-title":t.getInvalidOptionTooltip(e.attributeId,n.attributeValueId)},on:{click:function(i){return t.selectAttribute(e.attributeId,n.attributeValueId)}}},["box"===e.type?i("span",{staticClass:"mx-3"},[t._v(t._s(n.name))]):i("img",{staticClass:"p-1",attrs:{src:n.imageUrl,alt:n.name}})])}))],2)]):t._e()])})),t._v(" "),Object.keys(t.possibleUnits).length>1&&t.isContentVisible?i("div",{staticClass:"col-12 variation-select"},[i("div",{staticClass:"input-unit"},[i("select",{staticClass:"custom-select",on:{change:function(e){return t.selectUnit(e.target.value)}}},t._l(t.possibleUnits,(function(e,n){return i("option",{domProps:{value:n,selected:parseInt(n)===t.selectedUnit}},[t.isUnitSelectionValid(n)?[t._v("\n                            "+t._s(e)+"\n                        ")]:[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemInvalidAttribute",{name:e}))+"\n                        ")]],2)})),0),t._v(" "),i("label",[t._v(t._s(t.$translate("Ceres::Template.singleItemContent")))])])]):t._e()],2):i("div",[t._t("default")],2)])};n._withStripped=!0;i(6),i(12),i(13),i(3),i(27),i(111),i(8),i(58),i(76),i(47),i(31),i(4),i(320),i(48),i(59),i(153),i(10),i(9);var r=i(73),a=i(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=i(19),u={name:"variation-select",props:{forceContent:{type:Boolean,default:!1}},inject:{itemId:{default:null}},data:function(){return{filteredVariationsCache:{},lastContentCount:0}},mounted:function(){this.$store.commit("".concat(this.itemId,"/variationSelect/setIsVariationSelected"),!!this.currentSelection)},computed:{currentVariation:function(){return this.$store.getters["".concat(this.itemId,"/currentItemVariation")]},currentVariationSelect:function(){return this.$store.state.items[this.itemId]&&this.$store.state.items[this.itemId].variationSelect},hasEmptyOption:function(){return this.variations.some((function(t){return!t.attributes.length}))},addPleaseSelectOption:function(){return App.config.item.showPleaseSelect},currentSelection:function(){var t=this.filterVariations(null,null,!0);return 1===t.length&&t[0]},possibleUnits:function(){var t={},e=this.forceContent?this.variations:this.filterVariations(null,null,null,!0),i=!0,n=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;t[l.unitCombinationId]=l.unitName}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t},isContentVisible:function(){return!this.forceContent&&!!this.currentSelection||this.forceContent},hasSelection:function(){return!Object(a.d)(this.selectedAttributes)&&!Object.values(this.selectedAttributes).some((function(t){return t<0}))},attributes:function(){return this.currentVariationSelect&&this.currentVariationSelect.attributes},units:function(){return this.currentVariationSelect&&this.currentVariationSelect.units},selectedAttributes:function(){return this.currentVariationSelect&&this.currentVariationSelect.selectedAttributes},selectedUnit:function(){return this.currentVariationSelect&&this.currentVariationSelect.selectedUnit},variations:function(){return this.currentVariationSelect&&this.currentVariationSelect.variations}},methods:{selectAttribute:function(t,e){e=parseInt(e)||null,this.selectedAttributes[t]!==e&&(this.$store.commit("".concat(this.itemId,"/variationSelect/selectItemAttribute"),{attributeId:t,attributeValueId:e}),this.onSelectionChange(t,e,null))},selectUnit:function(t){t=parseInt(t),this.$store.commit("".concat(this.itemId,"/variationSelect/selectItemUnit"),t),this.onSelectionChange(null,null,t)},onSelectionChange:function(t,e,i){this.currentSelection?this.setVariation(this.currentSelection.variationId):this.hasSelection?this.unsetInvalidSelection(t,e,i):this.setVariation(0),this.lastContentCount=Object.keys(this.possibleUnits).length},unsetInvalidSelection:function(t,e,i){var n=this.getQualifiedVariations(t,e,i),r=this.getClosestVariation(n);if(r){var a=this.getInvalidSelectionByVariation(r);this.correctSelection(a)}},getInvalidOptionTooltip:function(t,e){var i=this.getQualifiedVariations(t,e),n=this.getClosestVariation(i);if(!n)return"";var r=this.getInvalidSelectionByVariation(n),a=[],s=!0,l=!1,o=void 0;try{for(var u,c=r.attributesToReset[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var d=u.value;d.attributeId!==t&&a.push("<b>"+d.name+"</b>")}}catch(t){l=!0,o=t}finally{try{s||null==c.return||c.return()}finally{if(l)throw o}}return r.newUnit&&a.push("<b>"+this.$translate("Ceres::Template.singleItemContent")+"</b>"),a.length?this.$translate("Ceres::Template.singleItemNotAvailableInSelection",{name:a.join(", ")}):null},getQualifiedVariations:function(t,e,i){return Object(a.b)(e)?this.variations.filter((function(i){return Object(a.b)(i.attributes.find((function(i){return i.attributeId===t&&i.attributeValueId===e})))})):Object(a.b)(i)?this.variations.filter((function(t){return t.unitCombinationId===i})):this.variations.filter((function(t){return!t.attributes.length}))},getClosestVariation:function(t){var e,i,n=!0,r=!1,s=void 0;try{for(var l,o=t[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var u=l.value,c=0;u.unitCombinationId===this.selectedUnit||Object(a.c)(this.selectedUnit)||c++;var d=!0,b=!1,h=void 0;try{for(var v,f=u.attributes[Symbol.iterator]();!(d=(v=f.next()).done);d=!0){var m=v.value;this.selectedAttributes[m.attributeId]!==m.attributeValueId&&c++}}catch(t){b=!0,h=t}finally{try{d||null==f.return||f.return()}finally{if(b)throw h}}(!i||c<i)&&(e=u,i=c)}}catch(t){r=!0,s=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}return e},getInvalidSelectionByVariation:function(t){var e=this,i=[],n=null,r=function(n){n=parseInt(n);var r=t.attributes.find((function(t){return t.attributeId===n}));if(!Object(a.c)(e.selectedAttributes[n])&&(r&&r.attributeValueId!==e.selectedAttributes[n]||!r)){var l=e.attributes.find((function(t){return t.attributeId===n}));i.push(l)}s=n};for(var s in this.selectedAttributes)r(s);return t.unitCombinationId!==this.selectedUnit&&(n=t.unitCombinationId),{attributesToReset:i,newUnit:n}},correctSelection:function(t){var e=[],i=JSON.parse(JSON.stringify(this.selectedAttributes)),n=!0,r=!1,s=void 0;try{for(var l,u=t.attributesToReset[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var c=l.value;e.push(this.$translate("Ceres::Template.singleItemNotAvailable",{name:c.name})),i[c.attributeId]=!this.hasEmptyOption&&App.config.item.showPleaseSelect?-1:null}}catch(t){r=!0,s=t}finally{try{n||null==u.return||u.return()}finally{if(r)throw s}}t.newUnit&&(this.lastContentCount>1&&Object.keys(this.possibleUnits).length>1&&!Object(a.c)(this.selectedUnit)&&e.push(this.$translate("Ceres::Template.singleItemNotAvailable",{name:this.$translate("Ceres::Template.singleItemContent")})),this.$store.commit("".concat(this.itemId,"/variationSelect/selectItemUnit"),t.newUnit)),this.$store.commit("".concat(this.itemId,"/variationSelect/setItemSelectedAttributes"),i),this.setVariation(this.currentSelection?this.currentSelection.variationId:0),o.warn(e.join("<br>")).closeAfter(5e3)},filterVariations:function(t,e,i,n){var r=this;t=t||this.selectedAttributes,e=e||this.selectedUnit,i=!!i,n=!!n;var o=JSON.stringify(t)+"_"+e+"_"+i+"_"+n;if(Object(a.b)(this.filteredVariationsCache[o]))return this.filteredVariationsCache[o];var u=l(new Set(Object.values(t))),c=1===u.length&&Object(a.c)(u[0]),d=this.variations.filter((function(l){if(!n&&l.unitCombinationId!==e)return!1;if((!c&&!l.attributes.length||c&&l.attributes.length)&&r.attributes.length>0)return!1;var o=function(e){var n=l.attributes.find((function(t){return t.attributeId===parseInt(e)}));if(n&&n.attributeValueId!==t[e]&&(i||!i&&!Object(a.c)(t[e])&&-1!==t[e]))return{v:!1}};for(var u in t){var d=o(u);if("object"===s(d))return d.v}return!0}));return this.filteredVariationsCache[o]=d,d},isAttributeSelectionValid:function(t,e){if(e=parseInt(e)||null,this.selectedAttributes[t]===e)return!0;var i=JSON.parse(JSON.stringify(this.selectedAttributes));i[t]=parseInt(e)||null;var n=!(Object.keys(this.possibleUnits).length>1&&this.isContentVisible);return!!this.filterVariations(i,null,null,n).length},isUnitSelectionValid:function(t){return t=parseInt(t),this.selectedUnit===t||!!this.filterVariations(null,t).length},setVariation:function(t){!Object(a.b)(t)&&this.currentSelection&&(t=this.currentSelection.variationId),Object(a.b)(t)&&this.$store.dispatch("".concat(this.itemId,"/loadVariation"),t).then((function(t){document.dispatchEvent(new CustomEvent("onVariationChanged",{detail:{attributes:t.attributes,documents:t.documents}}))}))},isTextCut:function(t){return!!this.$refs.attributesContaner&&Object(r.d)(t,"Custom-Font, Helvetica, Arial, sans-serif")>this.$refs.attributesContaner[0].clientWidth},getSelectedAttributeValueName:function(t){var e=this.selectedAttributes[t.attributeId],i=t.values.find((function(t){return t.attributeValueId===e}));return i?i.name:App.config.item.showPleaseSelect&&-1===e?this.$translate("Ceres::Template.singleItemPleaseSelect"):this.$translate("Ceres::Template.singleItemNoSelection")}},watch:{currentSelection:function(t){this.$store.commit("".concat(this.itemId,"/variationSelect/setIsVariationSelected"),!!t)}}},c=i(11),d=Object(c.a)(u,n,[],!1,null,null,null);d.options.__file="resources/js/src/app/components/item/VariationSelect.vue";e.default=d.exports}}]);
//# sourceMappingURL=ceres-8.min.js.map