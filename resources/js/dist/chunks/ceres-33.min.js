(self.webpackChunkCeres=self.webpackChunkCeres||[]).push([[33],{44699:function(t,e,i){var n=i(19781),a=i(1702),r=i(81956),s=i(45656),l=a(i(55296).f),o=a([].push),u=function(t){return function(e){for(var i,a=s(e),u=r(a),c=u.length,d=0,b=[];c>d;)i=u[d++],n&&!l(a,i)||o(b,t?[i,a[i]]:a[i]);return b}};t.exports={entries:u(!0),values:u(!1)}},69720:function(t,e,i){var n=i(82109),a=i(44699).entries;n({target:"Object",stat:!0},{entries:function(t){return a(t)}})},26833:function(t,e,i){var n=i(82109),a=i(44699).values;n({target:"Object",stat:!0},{values:function(t){return a(t)}})},75356:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return f}});i(68309),i(66992),i(41539),i(33948),i(91058);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[t.attributes.length||t.possibleUnitCombinationIds.length>1&&t.isContentVisible?[t._l(t.attributes,(function(i,n){return e("div",{key:n,staticClass:"col-12 variation-select"},["dropdown"===i.type?e("div",{ref:"attributesContaner",refInFor:!0,staticClass:"input-unit"},[e("select",{staticClass:"custom-select",attrs:{id:"custom-select_"+i.name,"data-testing":"variation-select-dropdown"},on:{change:function(e){return t.selectAttribute(i.attributeId,e.target.value)}}},[t.addPleaseSelectOption||!t.hasSelection?e("option",{domProps:{value:-1}},[t._v(t._s(t.$translate("Ceres::Template.singleItemPleaseSelect")))]):t._e(),t._v(" "),t.hasEmptyOption||null===t.selectedAttributes[i.attributeId]?e("option",{domProps:{value:null,selected:null===t.selectedAttributes[i.attributeId]}},[t._v(t._s(t.$translate("Ceres::Template.singleItemNoSelection")))]):t._e(),t._v(" "),t._l(i.values,(function(n){return e("option",{key:n.attributeValueId,domProps:{value:n.attributeValueId,selected:n.attributeValueId===t.selectedAttributes[i.attributeId]}},[t.isAttributeSelectionValid(i.attributeId,n.attributeValueId,!0)?[t._v("\n                            "+t._s(n.name)+"\n                        ")]:t.isAttributeSelectionValid(i.attributeId,n.attributeValueId,!1)?[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemNotSalableAttribute",{name:n.name}))+"\n                        ")]:[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemInvalidAttribute",{name:n.name}))+"\n                        ")]],2)}))],2),t._v(" "),e("label",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.isTextCut(i.name),expression:"isTextCut(attribute.name)"}],attrs:{for:"custom-select_"+i.name,"data-toggle":"tooltip","data-placement":"top",title:i.name,"data-testing":"variation-select-dropdown-label"}},[t._v(t._s(i.name))])]):"box"===i.type||"image"===i.type?e("div",[e("span",{staticClass:"text-muted",attrs:{"data-testing":"attribute-name"}},[t._v(t._s(i.name)+":")]),t._v(" "),e("b",{attrs:{"data-testing":"attribute-value"}},[t._v(t._s(t.getSelectedAttributeValueName(i)))]),t._v(" "),e("div",{staticClass:"v-s-boxes py-3",class:{images:"image"===i.type}},[t.addPleaseSelectOption?e("div",{staticClass:"v-s-box bg-white empty-option",class:{active:-1===t.selectedAttributes[i.attributeId],invalid:!t.isAttributeSelectionValid(i.attributeId,-1)},attrs:{"data-testing":"variation-select-box"},on:{click:function(e){return t.selectAttribute(i.attributeId,-1)}}},[e("span",{staticClass:"mx-3"},[t._v(t._s(t.$translate("Ceres::Template.singleItemPleaseSelect")))])]):t._e(),t._v(" "),t.hasEmptyOption?e("div",{staticClass:"v-s-box bg-white empty-option",class:{active:null===t.selectedAttributes[i.attributeId],invalid:!t.isAttributeSelectionValid(i.attributeId,null,!0)},attrs:{"data-testing":"variation-select-box"},on:{click:function(e){return t.selectAttribute(i.attributeId,null)}}},[e("span",{staticClass:"mx-3"},[t._v(t._s(t.$translate("Ceres::Template.singleItemNoSelection")))])]):t._e(),t._v(" "),t._l(i.values,(function(n){return e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:!0,expression:"true"}],key:n.attributeValueId,staticClass:"v-s-box bg-white",class:{active:n.attributeValueId===t.selectedAttributes[i.attributeId],invalid:!t.isAttributeSelectionValid(i.attributeId,n.attributeValueId,!0)},attrs:{"data-testing":"variation-select-box","data-html":"true","data-toggle":"tooltip","data-placement":"top","data-original-title":t.getTooltip(i,n)},on:{click:function(e){return t.selectAttribute(i.attributeId,n.attributeValueId)}}},["box"===i.type?e("span",{staticClass:"mx-3"},[t._v(t._s(n.name))]):e("img",{staticClass:"p-1",attrs:{src:n.imageUrl,alt:n.name}})])}))],2)]):t._e()])})),t._v(" "),t.possibleUnitCombinationIds.length>1&&t.isContentVisible?e("div",{staticClass:"col-12 variation-select"},[e("div",{staticClass:"input-unit"},[e("select",{staticClass:"custom-select",attrs:{id:"unit-combination-ids-select","data-testing":"variation-select-unit"},on:{change:function(e){return t.selectUnit(e.target.value)}}},t._l(t.possibleUnitCombinationIds,(function(i){return e("option",{key:i,domProps:{value:i,selected:parseInt(i)===t.selectedUnit}},[t.isUnitSelectionValid(i)?[t._v("\n                            "+t._s(t.possibleUnits[i])+"\n                        ")]:[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemInvalidAttribute",{name:t.possibleUnits[i]}))+"\n                        ")]],2)})),0),t._v(" "),e("label",{attrs:{for:"unit-combination-ids-select","data-testing":"variation-select-unit-label"}},[t._v(t._s(t.$translate("Ceres::Template.singleItemContent")))])])]):t._e()]:[t._t("default")]],2)};n._withStripped=!0;i(21249),i(26833),i(69600),i(57327),i(69826),i(70189),i(78783),i(47941),i(2707),i(69720),i(74916),i(15306),i(47042),i(91038),i(82526),i(41817),i(32165);var a=i(26278),r=i(29413);function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=u(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(l)throw r}}}}function u(t,e){if(t){if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var d=i(41841),b={name:"variation-select",props:{forceContent:{type:Boolean,default:!1}},inject:{itemId:{default:null}},data:function(){return{filteredVariationsCache:{},lastContentCount:0}},mounted:function(){this.$store.commit("".concat(this.itemId,"/variationSelect/setIsVariationSelected"),!!this.currentSelection)},computed:{currentVariation:function(){return this.$store.getters["".concat(this.itemId,"/currentItemVariation")]},currentVariationSelect:function(){return this.$store.state.items[this.itemId]&&this.$store.state.items[this.itemId].variationSelect},hasEmptyOption:function(){return this.variations.some((function(t){return!t.attributes.length}))},addPleaseSelectOption:function(){return App.config.item.showPleaseSelect},currentSelection:function(){var t=this.filterVariations(null,null,!0);return 1===t.length&&t[0]},possibleUnits:function(){var t,e={},i=o(this.forceContent?this.variations:this.filterVariations(null,null,null,!0));try{for(i.s();!(t=i.n()).done;){var n=t.value;e[n.unitCombinationId]=n.unitName}}catch(t){i.e(t)}finally{i.f()}return e},possibleUnitCombinationIds:function(){return this.transformPossibleUnits(this.possibleUnits).map((function(t){return t[0]}))},isContentVisible:function(){return!this.forceContent&&!!this.currentSelection||this.forceContent},hasSelection:function(){return!(0,r.le)(this.selectedAttributes)&&!Object.values(this.selectedAttributes).some((function(t){return t<0}))},attributes:function(){return this.currentVariationSelect&&this.currentVariationSelect.attributes},selectedAttributes:function(){return this.currentVariationSelect&&this.currentVariationSelect.selectedAttributes},selectedUnit:function(){return this.currentVariationSelect&&this.currentVariationSelect.selectedUnit},variations:function(){return this.currentVariationSelect&&this.currentVariationSelect.variations}},methods:{selectAttribute:function(t,e){e=parseInt(e)||null,this.selectedAttributes[t]!==e&&(this.$store.commit("".concat(this.itemId,"/variationSelect/selectItemAttribute"),{attributeId:t,attributeValueId:e}),this.onSelectionChange(t,e,null))},selectUnit:function(t){t=parseInt(t),this.$store.commit("".concat(this.itemId,"/variationSelect/selectItemUnit"),t),this.onSelectionChange(null,null,t)},onSelectionChange:function(t,e,i){this.currentSelection?this.setVariation(this.currentSelection.variationId):this.hasSelection?this.unsetInvalidSelection(t,e,i):this.setVariation(0),this.lastContentCount=this.possibleUnitCombinationIds.length},unsetInvalidSelection:function(t,e,i){var n=this.getQualifiedVariations(t,e,i),a=this.getClosestVariations(n),r=a[0]||a[1];if(r){var s=this.getInvalidSelectionByVariation(r);this.correctSelection(s)}},getTooltip:function(t,e){return this.isAttributeSelectionValid(t.attributeId,e.attributeValueId,!0)?"image"===t.type?this.$translate("Ceres::Template.singleItemAttributeTooltip",{attribute:t.name,value:e.name}):"":this.getInvalidOptionTooltip(t.attributeId,e.attributeValueId)},getInvalidOptionTooltip:function(t,e){var i=this.getQualifiedVariations(t,e),n=this.getClosestVariations(i);if(!n||n.length<=0)return"";var a=[n[0]?this.getInvalidSelectionByVariation(n[0]):null,n[1]?this.getInvalidSelectionByVariation(n[1]):null];if(a[0]&&a[1]&&a[0].attributesToReset.length>a[1].attributesToReset.length)return this.$translate("Ceres::Template.singleItemNotSalable");var r,s=a[0]||a[1],l=[],u=o(s.attributesToReset);try{for(u.s();!(r=u.n()).done;){var c=r.value;c.attributeId!==t&&l.push("<b>"+c.name+"</b>")}}catch(t){u.e(t)}finally{u.f()}return s.newUnit&&l.push("<b>"+this.$translate("Ceres::Template.singleItemContent")+"</b>"),l.length?this.$translate("Ceres::Template.singleItemNotAvailableInSelection",{name:l.join(", ")}):null},getQualifiedVariations:function(t,e,i){return(0,r.$K)(e)?this.variations.filter((function(i){return(0,r.$K)(i.attributes.find((function(i){return i.attributeId===t&&i.attributeValueId===e})))})):(0,r.$K)(i)?this.variations.filter((function(t){return t.unitCombinationId===i})):this.variations.filter((function(t){return!t.attributes.length}))},getClosestVariations:function(t){var e,i,n,a,s,l=o(t);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=0;if(u.unitCombinationId!==this.selectedUnit&&!(0,r.Ft)(this.selectedUnit))c+=this.possibleUnitCombinationIds.length>1&&this.isContentVisible?.9:.1;var d,b=o(u.attributes);try{for(b.s();!(d=b.n()).done;){var f=d.value;this.selectedAttributes[f.attributeId]!==f.attributeValueId&&c++}}catch(t){b.e(t)}finally{b.f()}u.isSalable&&(!i||c<i)?(e=u,i=c):u.isSalable||a&&!(c<a)||(n=u,a=c)}}catch(t){l.e(t)}finally{l.f()}return[e,n]},getInvalidSelectionByVariation:function(t){var e=this,i=[],n=null,a=function(n){n=parseInt(n);var a=t.attributes.find((function(t){return t.attributeId===n}));if(!(0,r.Ft)(e.selectedAttributes[n])&&(a&&a.attributeValueId!==e.selectedAttributes[n]||!a)){var s=e.attributes.find((function(t){return t.attributeId===n}));i.push(s)}};for(var s in this.selectedAttributes)a(s);return t.unitCombinationId!==this.selectedUnit&&(n=t.unitCombinationId),{attributesToReset:i,newUnit:n}},correctSelection:function(t){var e,i=[],n=JSON.parse(JSON.stringify(this.selectedAttributes)),a=o(t.attributesToReset);try{for(a.s();!(e=a.n()).done;){var s=e.value;i.push(this.$translate("Ceres::Template.singleItemNotAvailable",{name:s.name})),n[s.attributeId]=!this.hasEmptyOption&&App.config.item.showPleaseSelect?-1:null}}catch(t){a.e(t)}finally{a.f()}t.newUnit&&(this.lastContentCount>1&&this.possibleUnitCombinationIds.length>1&&!(0,r.Ft)(this.selectedUnit)&&i.push(this.$translate("Ceres::Template.singleItemNotAvailable",{name:this.$translate("Ceres::Template.singleItemContent")})),this.$store.commit("".concat(this.itemId,"/variationSelect/selectItemUnit"),t.newUnit)),this.$store.commit("".concat(this.itemId,"/variationSelect/setItemSelectedAttributes"),n),this.setVariation(this.currentSelection?this.currentSelection.variationId:0),d.warn(i.join("<br>")).closeAfter(5e3)},filterVariations:function(t,e,i,n){var a=this;t=t||this.selectedAttributes,e=e||this.selectedUnit,i=!!i,n=!!n;var o=JSON.stringify(t)+"_"+e+"_"+i+"_"+n;if((0,r.$K)(this.filteredVariationsCache[o]))return this.filteredVariationsCache[o];var u=l(new Set(Object.values(t))),c=1===u.length&&(0,r.Ft)(u[0]),d=this.variations.filter((function(l){if(!n&&l.unitCombinationId!==e)return!1;if((!c&&!l.attributes.length||c&&l.attributes.length)&&a.attributes.length>0)return!1;var o=function(e){var n=l.attributes.find((function(t){return t.attributeId===parseInt(e)}));if(n&&n.attributeValueId!==t[e]&&(i||!i&&!(0,r.Ft)(t[e])&&-1!==t[e]))return{v:!1}};for(var u in t){var d=o(u);if("object"===s(d))return d.v}return!0}));return this.filteredVariationsCache[o]=d,d},isAttributeSelectionValid:function(t,e,i){if(e=parseInt(e)||null,this.selectedAttributes[t]===e)return!0;var n=JSON.parse(JSON.stringify(this.selectedAttributes));n[t]=parseInt(e)||null;var a=!(Object.keys(this.possibleUnits).length>1&&this.isContentVisible),r=this.filterVariations(n,null,null,a);return i&&(r=r.filter((function(t){return t.isSalable}))),r.length>0},isUnitSelectionValid:function(t){return t=parseInt(t),this.selectedUnit===t||this.filterVariations(null,t).filter((function(t){return t.isSalable})).length>0},setVariation:function(t){var e=this;!(0,r.$K)(t)&&this.currentSelection&&(t=this.currentSelection.variationId),(0,r.$K)(t)&&this.$store.dispatch("".concat(this.itemId,"/loadVariation"),t).then((function(t){document.dispatchEvent(new CustomEvent("onVariationChanged",{detail:{attributes:t.attributes,documents:t.documents,itemId:e.itemId}}))}))},isTextCut:function(t){return!!this.$refs.attributesContaner&&(0,a.$H)(t,"Custom-Font, Helvetica, Arial, sans-serif")>this.$refs.attributesContaner[0].clientWidth},getSelectedAttributeValueName:function(t){var e=this.selectedAttributes[t.attributeId],i=t.values.find((function(t){return t.attributeValueId===e}));return i?i.name:App.config.item.showPleaseSelect&&-1===e?this.$translate("Ceres::Template.singleItemPleaseSelect"):this.$translate("Ceres::Template.singleItemNoSelection")},transformPossibleUnits:function(t){var e=this;return Object.entries(t).sort((function(t,i){return t=e.splitUnitName(t[1]),i=e.splitUnitName(i[1]),t[1]<i[1]?-1:t[1]>i[1]?1:t[0]<i[0]?-1:t[0]>i[0]?1:0}))},splitUnitName:function(t){var e=t.split(" ");return isNaN(e[0])||(e[0]=e[0].replace(App.currencyPattern.separator_thousands,""),e[0]=parseInt(e[0])),e}},watch:{currentSelection:function(t){this.$store.commit("".concat(this.itemId,"/variationSelect/setIsVariationSelected"),!!t)},variations:function(){this.filteredVariationsCache={}}}},f=(0,i(51900).Z)(b,n,[],!1,null,null,null).exports}}]);
//# sourceMappingURL=ceres-33.min.js.map