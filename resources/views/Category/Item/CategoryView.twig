{% extends getPartial('page-design') %}
{% import "Ceres::Category.Macros.CategoryTree" as Tree %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}

{% block PageBody %}

    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterList") }}
    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterTagList") }}
    {{ component( "Ceres::ItemList.Components.ItemList") }}
    {{ component( "Ceres::ItemList.Components.CategoryItem") }}
    {{ component( "Ceres::ItemList.Components.CategoryImageCarousel") }}

    {% if ceresConfig.item.showCategoryImage %}
        {% include "Ceres::Category.Item.Partials.CategoryParallaxImage" with { 'category': category } %}
    {% endif %}

    {% set shippingCat = config("Ceres.global.shippingCostsCategoryId") %}

    {% set categoryDescriptionTop = ceresConfig.item.showCategoryDescriptionTop %}
    {% set categoryDescriptionBottom = ceresConfig.item.showCategoryDescriptionBottom %}

    <div class="categoriegrid page-content container-max">
        {% if not ceresConfig.item.showCategoryImage %}
            <div class="row m-t-1">
                <div class="col-xs-12">
                    <h1 class="h2 category-title">{{ category.details[0].name }}</h1>
                    {% if categoryDescriptionTop == "description1" or categoryDescriptionTop == "both" %}
                        <div class="category-description m-b-1">{{ category.details[0].description | raw }}</div>
                    {% endif %}
                    {% if categoryDescriptionTop == "description2" or categoryDescriptionTop == "both" %}
                        <div class="category-description m-b-1">{{ category.details[0].description2 | raw }}</div>
                    {% endif %}
                </div>
            </div>
        {% endif %}

        <div class="list-controls m-b-3">
            <div class="list-controls-inner">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="list-wrapper">
                            {% include "Ceres::Category.Item.Partials.CategorySorting" with { 'sortingData': searchOptions.sorting, 'selectedSorting': itemSorting } %}

                            {% include "Ceres::Category.Item.Partials.ItemsPerPage" with { 'itemsPerPage': searchOptions.itemsPerPage, 'selectedValue': itemsPerPage } %}

                            {% set overrideSearchFilters = LayoutContainer.show("Ceres::Search.Filter", facets ) %}
                            {% if overrideSearchFilters | trim is empty %}
                                <item-filter-list :facet-data="{{ facets | json_encode }}">
                                    {% if facets | length > 0 %}
                                        <a class="btn btn-link filter-toggle" href="#filterCollapse">
                                            <i class="fa fa-sliders default-float" aria-hidden="true"></i> {{ trans("Ceres::Template.itemFilter") }}
                                        </a>
                                    {% endif %}
                                </item-filter-list>
                            {% else %}
                                {{ overrideSearchFilters }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            {# TAGS #}
            <item-filter-tag-list></item-filter-tag-list>
        </div>

        {% if ceresConfig.pagination.position in ['top', 'top_bottom'] %}
            <div class="list-controls m-b-3 row">
                <div class="col-xs-12">
                    {% include "Ceres::Category.Item.Partials.Pagination" %}
                </div>
            </div>
        {% endif %}

        <div class="row">

            {% if ceresConfig.header.showNavBars == "side" or ceresConfig.header.showNavBars == "both" %}
                <div class="col-xs-3 hidden-md-down">
                    <div class="sidebar-categories">
                        <div class="category-title">{{ trans("Ceres::Template.itemCategories") }}</div>
                        {{ include('Ceres::PageDesign.Partials.Header.SideNavigation.twig') }}
                    </div>

                    {{ LayoutContainer.show("Ceres::CategoryItem.SideNavBarBottom") }}
                </div>

            {% endif %}

            <div class="col-xs-12 col-lg-{% if ceresConfig.header.showNavBars == "side" or ceresConfig.header.showNavBars == "both" %}9{% else %}12{% endif %}">
                {% if config("Ceres.test.twig") == "true" %}
                <div id="twig-rendered-item-list" class="item-list-frame{% if ceresConfig.item.loadingAnimationType == "blur" %} blur-effect{% endif %}">

                    {% if ceresConfig.item.loadingAnimationType != "blur" %}
                        {% include "Ceres::ItemList.Partials.LoadingAnimation" %}
                    {% endif %}

                    <ul class="product-list row grid" :class="{ 'loading': $store.state.itemList.isLoading }">
                        {% for item in itemList %}
                            <li class="col-xs-12 col-sm-6 col-md-4 col-lg-{% if ceresConfig.header.showNavBars == "side" or ceresConfig.header.showNavBars == "both" %}4{% else %}3{% endif %}">
                                {% include "Ceres::Category.Item.Partials.CategoryListItem" with { 'item': item, 'shippingCat': shippingCat } %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                {% else %}

                {# TODO remove #}
                <div id="vue-rendered-item-list">
                    <item-list :item-data="{{ itemList | json_encode }}" template="#vue-item-list" :total-items-data="{{ itemCountTotal }}" :category-id="{{ category.id }}">
                        <ul class="product-list row grid">
                            {% for item in itemList %}
                                <li class="col-xs-12 col-sm-6 col-md-4 col-lg-4">
                                    <article class="cmp cmp-product-thumb">
                                        <div class="thumb-inner">
                                            <div class="thumb-image">
                                                <div class="square-container">
                                                    <div class="square-inner main-image">
                                                        <a>
                                                            <img class="img-fluid" src="" alt="">
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="thumb-content">
                                                <div class="thumb-meta">
                                                    <div class="prices">
                                                        <div class="price-view-port">
                                                            <del class="crossprice">
                                                                100,00EUR
                                                            </del>
                                                        </div> 
                                                        <div class="price">
                                                            79,00EUR *
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </article>
                                </li>
                            {% endfor %}
                        </ul>
                    </item-list>
                </div>

                {% endif %}

            </div>
        </div>
        {% if ceresConfig.pagination.position in ['bottom', 'top_bottom'] %}
            <div class="list-controls m-b-3 row">
                <div class="col-xs-12">
                    {% include "Ceres::Category.Item.Partials.Pagination" %}
                </div>
            </div>
        {% endif %}

        <div class="col-xs-12">
            {% if categoryDescriptionBottom == "description1" or categoryDescriptionBottom == "both" %}
                <div class="category-description m-b-1">{{ category.details[0].description | raw }}</div>
            {% endif %}
            {% if categoryDescriptionBottom == "description2" or categoryDescriptionBottom == "both" %}
                <div class="category-description m-b-1">{{ category.details[0].description2 | raw }}</div>
            {% endif %}
        </div>
    </div>

{% endblock %}

{% block PartialHead %}
    <script type="application/ld+json">{"@context": "http://schema.org","@type": "WebSite","url": "{{ webstoreConfig.domainSsl }}","potentialAction":{"@type": "SearchAction","target": "{{ webstoreConfig.domainSsl }}/search?query={search_term}","query-input": "required name=search_term"}}</script>

    {% if currentPage-1 > 0 %}
        <link rel="prev" href="{{ webstoreConfig.domainSsl }}?{{ query | merge({'page' : currentPage-1 }) | url_encode }}" />
    {% endif %}

    {% if currentPage+1 <= pageMax %}
        <link rel="next" href="{{ webstoreConfig.domainSsl }}?{{ query | merge({'page' : currentPage+1 }) | url_encode }}" />
    {% endif %}

    <title>{% if category.details[0].metaTitle %}{{ category.details[0].metaTitle }}{% else %}{{ category.details[0].name }}{% endif %} | {{ trans("Ceres::Template.headerCompanyName") }}</title>

    <meta name="description" content="{{ category.details[0].metaDescription }}">
    <meta name="keywords" content="{{ category.details[0].metaKeywords }}">
    <meta name="robots" content="{% if forceNoIndex or (currentPage >= config("Ceres.pagination.noIndex") and config("Ceres.pagination.noIndex") != 0 )%}NOINDEX{% else %}{{ metaRobots }}{% endif %}">
{% endblock %}
