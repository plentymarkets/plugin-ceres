{% import "Ceres::Widgets.Helper.TwigBuilder" as Twig %}
{% import "Ceres::Widgets.Helper.WidgetHelper" as WidgetHelper %}

{% set customClass = widget.settings.customClass.mobile %}
{% set appearance = widget.settings.appearance.mobile %}
{% set redirect = widget.settings.redirect.mobile | default(false) %}

{% set spacingSettings = widget.settings.spacing %}
{% set inlineSpacings = WidgetHelper.getInlineSpacings(spacingSettings, spacingSettings.customPadding.mobile, spacingSettings.customMargin.mobile) %}
{% set spacingClasses = WidgetHelper.getSpacingClasses(spacingSettings, spacingSettings.customPadding.mobile, spacingSettings.customMargin.mobile) %}

{{ Twig.do("set textTranslations = {}") }}
{{ Twig.do("set buttonTranslations = {}") }}
{{ Twig.set("languageList", Twig.call("services.webstoreConfigurationRepository.getActiveLanguageList")) }}
{{ Twig.for("language", "languageList") }}
    {{ Twig.set("languageISO", "services.localizationRepository.getLanguageCode(language)") }}
    {{ Twig.do("set textTranslations = textTranslations | merge({(languageISO): trans('Ceres::Template.languageDetectionText', [], languageISO ) })") }}
    {{ Twig.do("set buttonTranslations = buttonTranslations | merge({(languageISO): trans('Ceres::Template.languageDetectionButton', [], languageISO ) })") }}
{{ Twig.endfor() }}

<div class="language-detection header-fw widget-{{ appearance }}{% if customClass | length > 0 %} {{ customClass }}{% endif %}">
    <div class="bg-appearance">
        <div class="container-max">
            <div class="{% if spacingClasses | length > 0 %}{{ spacingClasses }}{% endif %}"{% if inlineSpacings | length > 0 %} style="{{ inlineSpacings }}"{% endif %}>
                {% if isPreview %}
                    <div class="align-center">
                        Language Detection
                    </div>
                {% else %}
                <language-detection
                    :auto-redirect="{{ redirect | json_encode }}"
                    :texttranslations="{{ Twig.print('textTranslations | json_encode') }}"
                    :buttontranslations="{{ Twig.print('buttonTranslations | json_encode') }}"
                >
                </language-detection>
                {% endif %}
            </div>
        </div>
    </div>
</div>
